name: C/C++ CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: windows-latest
    defaults:
          run:
            shell: msys2 {0}
    steps:
    - name: Setup MSYS2
      uses: msys2/setup-msys2@v2
      with:
          msystem: MINGW64
          update: true
          path-type: inherit
          install: git mingw-w64-x86_64-toolchain 
          
    - run: git clone https://github.com/lexborisov/Modest.git 
    - run: cd Modest&&make -j4 prefix=/usr MyCORE_BUILD_WITHOUT_THREADS=YES&&sudo make install&&cd ../
    - run: export -p
    - run: sudo apt-get install python3 python3-pip ninja-build pkg-config cmake checkinstall -y
    - run: python3 -m pip install --upgrade pip
    - run: python3 -m pip install --upgrade --user setuptools
    - run: python3 -m pip install --user meson
    - uses: actions/checkout@v2
    - name: 配置 meson
      run: sudo update-alternatives --install /usr/bin/meson meson /home/runner/.local/bin/meson 1088
    - name: meson build
      run: PATH=${PATH}:/home/runner/.local/bin&&meson build 
    - name: ninja -C build
      run: ninja -C build
    - name: 测试
      run: ./build/hq -h
